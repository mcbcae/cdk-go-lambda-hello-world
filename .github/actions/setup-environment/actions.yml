name: 'Setup Environment'

description: 'Setup Go and Node.js environments'

runs:
  using: 'composite'
  steps:

    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/checkout@v4
      uses: actions/setup-go@v5
      with:
        go-version: '1.22.2'
      run: go version

    - name: Set up Node.js
      uses: actions/checkout@v4
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install AWS CDK and dependencies
      run: |
        npm install -g aws-cdk aws-cdk-lib

    - name: Build Go binary and zip
      run: |
        cd lambda
        rm -rf bootstrap function.zip
        GOOS=linux GOARCH=amd64 go build -o bootstrap main.go
        zip function.zip bootstrap